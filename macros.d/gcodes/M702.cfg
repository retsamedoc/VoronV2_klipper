##   Unload filament
[gcode_macro M702]
gcode:
   {% if printer.toolhead.status == "Ready" %}
      SAVE_GCODE_STATE NAME=unloading_filament
      M125 # park
      M117 Unloading Filament 
      G91 # set relative
      G1 E10 F100 
      G92 E0.0
      G1 E-530 F6000 # the E is the length of the bowden tube (420mm) + 100 mm. 
      G92 E0.0
      RESTORE_GCODE_STATE name=unloading_filament MOVE=1
   {% else %}
      { printer.gcode.action_respond_info("Filament unloading disabled while printing!") }
   {% endif %}   
